---
import { Icon } from 'astro-icon/components';
import NavItem from './NavItem.astro';
---

<section
    x-data="{
        open: false,
        activePage: window.location.pathname.replaceAll('/','') || 'home',
        isActive(page) { return page == this.activePage },
        hoveredNavItem: '',
        lastHoveredItem: '',
        atTop: true,
        init() {
            this.$watch('hoveredNavItem', (newItem, oldItem) => {
                if (newItem && newItem !== '' && newItem !== 'home') {
                    this.lastHoveredItem = newItem;
                }
            });
        }
    }"
    @scroll.window="atTop = !window.scrollY"
>
    <nav
        class="fixed z-10 flex h-auto w-auto flex-col-reverse items-end text-neutral-100 transition-all duration-1000 max-md:bottom-2 max-md:right-2 max-md:rounded-xl max-md:bg-black-900 md:inset-x-0 md:z-10 md:block md:p-4"
        :class="atTop ? 'backdrop-opacity-0' : 'md:backdrop-blur md:bg-black/20'"
    >
        <div
            x-show="open"
            x-ref="nav-container"
            class="relative md:mx-auto md:!flex md:!h-auto md:max-w-screen-2xl md:items-center md:!overflow-visible"
            x-collapse
            x-cloak
        >
            <a
                href="/"
                aria-label="homepage"
                class="w-16 px-4 max-md:hidden"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 63 44"
                    ><path
                        d="M63.035 0h-12.11l-12.73 44.031h12.106Zm0 0"
                        style="stroke:none;fill-rule:nonzero;fill:red;fill-opacity:1"
                    ></path><path
                        d="m33.625 28.14 3.543-12.245 2.496-8.637L37.57 0H25.46l4.614 15.895-13.37-.004L12.108 0H0l12.73 44.031h12.11l-4.594-15.89Zm0 0"
                        style="stroke:none;fill-rule:nonzero;fill:#fff;fill-opacity:1"
                    ></path></svg
                >
            </a>
            <ul
                class="left-4 top-4 flex flex-col overflow-hidden p-4 text-xl font-semibold max-md:gap-2 max-md:pb-16 md:inset-0 md:!flex md:!h-auto md:w-full md:flex-row md:justify-end md:!overflow-visible md:p-0 md:text-base"
                role="menubar"
            >
                <div
                    x-ref="nav-items"
                    class="relative flex"
                    @mouseleave="hoveredNavItem = ''"
                >
                    <span
                        x-show="(hoveredNavItem && hoveredNavItem !== '') || (activePage !== 'home' && !hoveredNavItem)"
                        x-transition:enter="transition ease-in-out duration-500"
                        x-transition:enter-start="opacity-0 transform translate-y-2"
                        x-transition:enter-end="opacity-100 transform translate-y-0"
                        x-transition:leave="transition ease-in-out duration-500"
                        x-transition:leave-start="opacity-100 transform translate-y-0"
                        x-transition:leave-end="opacity-0 transform translate-y-2"
                        class="absolute -z-10 h-full rounded-xl bg-black-700/50 transition-all duration-500 ease-in-out max-md:hidden"
                        :style="{
                            width: `${$refs[hoveredNavItem || lastHoveredItem || activePage]?.offsetWidth || 0}px`,
                            left: `${$refs[hoveredNavItem || lastHoveredItem || activePage]?.offsetLeft || 0}px`
                        }"
                    ></span>
                    <NavItem
                        href="/webdev"
                        page="webdev"
                        label="Web Development"
                    />
                    <NavItem
                        href="/film"
                        page="film"
                        label="Film Photography"
                    />
                    <NavItem
                        href="/free-clout"
                        page="free-clout"
                        label="Good Stuff"
                    />
                    <NavItem
                        href="/"
                        page="home"
                        class="md:hidden"
                        label="Home"
                    />
                </div>
            </ul>
        </div>
    </nav>
    <div
        @click="open = !open"
        class="fixed bottom-0 right-0 z-10 flex h-20 w-20 cursor-pointer items-center justify-center md:hidden"
    >
        <Icon
            name="octicon:triangle-up-24"
            size="32"
            class="transition-transform duration-300"
            :class="open ? 'rotate-180' : 'rotate-0'"
        />
    </div>
</section>
